<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Listas de Compras Semanales</title>
  <style>
    body { font-family: sans-serif; margin:0; padding:0; background:#f5f5f5; }
    .container { max-width:600px; margin:0 auto; padding:20px; }
    h1 { text-align:center; }

    /* Semana / lista controls: fuente grande */
    .list-selector select,
    .list-selector input,
    .list-selector button { font-size:1.2em; }
    .list-selector, .controls {
      display:flex; gap:10px; flex-wrap:wrap;
      margin-bottom:10px; align-items:center;
    }
    .controls label { cursor:pointer; }

    /* Total gastado */
    #totalSpent {
      font-size:1.1em; margin-bottom:10px; font-weight:bold;
    }

    /* Formulario */
    #addItemSection summary {
      background:#3498db; color:#fff; padding:8px 12px;
      border-radius:4px; cursor:pointer; user-select:none;
      margin-bottom:10px; font-size:1.1em;
    }
    #addItemSection summary:hover { background:#2980b9; }
    form {
      display:flex; flex-wrap:wrap; gap:10px;
      background:#fff; padding:15px; border-radius:4px; border:1px solid #ddd;
    }
    form input, form select, form textarea, form button {
      flex:1 1 100%; padding:10px; font-size:1em;
      border:1px solid #ccc; border-radius:4px;
    }
    form .half { flex:1 1 calc(50% - 10px); }
    form label, form button { cursor:pointer; }

    /* Lista principal */
    #itemList details.category-group { margin-bottom:15px; }
    #itemList summary.category-header {
      font-weight:bold; background:#ddd; padding:8px;
      border-radius:4px; cursor:pointer; user-select:none;
      list-style:none; font-size:1.05em;
    }
    #itemList ul { list-style:none; margin:0; padding:0; }
    #itemList ul li {
      background:#fff; margin:8px 0; padding:10px;
      border-radius:4px; border:1px solid #ddd;
      display:flex; flex-direction:column; font-size:1em;
    }
    #itemList ul li.checked {
      opacity:0.6; text-decoration:line-through; background:#e0e0e0;
    }
    #itemList ul li.showing-hidden { opacity:0.4; }
    .item-header { display:flex; align-items:center; margin-bottom:5px; }
    .item-header input.item-checkbox {
      margin-right:10px; transform:scale(1.3); cursor:pointer;
    }
    .item-header h2 {
      margin:0; font-size:1.1em; flex:1; cursor:pointer;
    }
    .item-header button {
      margin-left:5px; padding:5px 10px; border:none;
      border-radius:4px; color:#fff; cursor:pointer; font-size:0.9em;
    }
    .edit   { background:#3498db; }
    .hide   { background:#f39c12; }
    .show   { background:#27ae60; }
    .delete { background:#e74c3c; }
    .item-details { font-size:0.9em; color:#555; }

    /* Filtro por pasillo */
    #filterList {
      margin-top:30px; background:#fafafa; padding:15px;
      border-radius:4px; border:1px solid #ccc;
    }
    #filterList h2 { margin-top:0; font-size:1.2em; text-align:center; }
    #filterList h3 { margin:15px 0 5px; font-size:1.1em; }
    #filterList ul { list-style:none; padding-left:0; }
    #filterList ul li { padding:4px 0; font-size:1em; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Listas de Compras Semanales</h1>

    <!-- Semana selector -->
    <div class="list-selector">
      <select id="weekSelect"></select>
      <input type="text" id="newWeekName" placeholder="Nombre nueva lista">
      <button id="createWeekBtn">Crear lista</button>
      <button id="deleteWeekBtn">Eliminar lista</button>
    </div>

    <!-- Mostrar ocultos & Export CSV -->
    <div class="controls">
      <label><input type="checkbox" id="toggleHidden"> Mostrar ocultos</label>
      <button id="exportCsvBtn">Exportar CSV</button>
    </div>

    <!-- Total gastado -->
    <div id="totalSpent">Total gastado: $0.00</div>

    <!-- Collapsible add/edit form -->
    <details id="addItemSection" open>
      <summary>Agregar / Editar ítem</summary>
      <form id="itemForm">
        <input type="text" id="name" placeholder="Producto" required>
        <input type="number" id="quantity" placeholder="Cantidad" class="half" min="1" required>
        <select id="category" class="half" required>
          <option value="">Categoría</option>
          <option>Produce</option><option>Proteins</option><option>Dairy</option>
          <option>Pantry & Carbs</option><option>Frozen Foods</option><option>Beverages</option>
          <option>Snacks & Treats</option><option>Condiments & Oils</option><option>Bakery</option>
          <option>Household & Personal Care</option><option>Dog (Benji)</option>
        </select>
        <input type="text" id="aisle" placeholder="Pasillo" class="half">
        <input type="number" id="price" placeholder="Precio" class="half" step="0.01" required>
        <input type="text" id="frequency" placeholder="Frecuencia" class="half" required>
        <textarea id="notes" placeholder="Notas"></textarea>

        <label style="flex:1 1 100%; margin-top:-5px;">
          <input type="checkbox" id="makeDefault"> Predeterminado
        </label>

        <button type="submit" id="submitBtn">Agregar ítem</button>
        <button type="button" id="cancelAdd" style="display:none;">Cancelar</button>
      </form>
    </details>

    <!-- Rendered main list -->
    <div id="itemList"></div>

    <!-- Filter by aisle -->
    <div id="filterList"></div>
  </div>

  <script>
    const LS_KEY = 'shoppingLists';
    let editingIndex = null;

    const categoryOrder = [
      'Produce','Proteins','Dairy','Pantry & Carbs','Frozen Foods',
      'Beverages','Snacks & Treats','Condiments & Oils','Bakery',
      'Household & Personal Care','Dog (Benji)'
    ];

    const DEFAULT_ITEMS = [
      { name:'moras',quantity:1,category:'Produce',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'fresas',quantity:1,category:'Produce',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'guineos',quantity:10,category:'Produce',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'uvas',quantity:1,category:'Produce',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'limon',quantity:1,category:'Produce',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'yogurt griego',quantity:3,category:'Dairy',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'Pure de yuca',quantity:3,category:'Pantry & Carbs',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'sweet potato fries',quantity:1,category:'Frozen Foods',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'brocoli',quantity:1,category:'Produce',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'lechuga',quantity:1,category:'Produce',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'arroz',quantity:1,category:'Pantry & Carbs',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'avena',quantity:1,category:'Pantry & Carbs',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'granola',quantity:2,category:'Pantry & Carbs',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'maiz',quantity:2,category:'Produce',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'mantequilla',quantity:2,category:'Dairy',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'habichuela',quantity:1,category:'Proteins',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'helado',quantity:1,category:'Frozen Foods',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'zumo limon',quantity:1,category:'Beverages',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'fresas congeladas',quantity:1,category:'Frozen Foods',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'jugo',quantity:1,category:'Beverages',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'leche',quantity:3,category:'Dairy',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'popcorn',quantity:1,category:'Snacks & Treats',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'spray aceite',quantity:1,category:'Condiments & Oils',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'queso cheddar',quantity:1,category:'Dairy',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'mozzarella',quantity:1,category:'Dairy',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'huevos',quantity:1,category:'Proteins',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'toallitas humedas',quantity:2,category:'Household & Personal Care',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'prossicuto',quantity:1,category:'Proteins',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'longas de pechuga de pollo',quantity:1,category:'Proteins',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'pechugas de pollo',quantity:2,category:'Proteins',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'carne de res',quantity:5,category:'Proteins',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'pescado',quantity:1,category:'Proteins',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'carne molida',quantity:2,category:'Proteins',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'tocineta',quantity:1,category:'Proteins',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'cocacola sin azucar',quantity:1,category:'Beverages',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'crema de leche',quantity:1,category:'Dairy',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'cereal',quantity:2,category:'Pantry & Carbs',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'pasta y salsa',quantity:1,category:'Pantry & Carbs',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'pancake',quantity:1,category:'Bakery',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'tuna',quantity:3,category:'Proteins',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'aguacate',quantity:2,category:'Produce',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'honey',quantity:1,category:'Condiments & Oils',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'coffee',quantity:1、category:'Beverages',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'crema batida',quantity:1,category:'Dairy',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'chocolate chips',quantity:1,category:'Snacks & Treats',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'beef broth',quantity:1,category:'Pantry & Carbs',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'friendly benji treats',quantity:1,category:'Dog (Benji)',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'comida humeda',quantity:1,category:'Dog (Benji)',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false },
      { name:'comida solida',quantity:1,category:'Dog (Benji)',aisle:'',price:'0.00',frequency:'',notes:'',checked:false,hidden:false }
    ];
    function getAll() {
      const raw = localStorage.getItem(LS_KEY);
      const data = raw
        ? JSON.parse(raw)
        : { current:'', lists:{}, defaultItems:JSON.parse(JSON.stringify(DEFAULT_ITEMS)) };
      if (!data.defaultItems) data.defaultItems = JSON.parse(JSON.stringify(DEFAULT_ITEMS));
      return data;
    }
    function saveAll(d) { localStorage.setItem(LS_KEY, JSON.stringify(d)); }
    function init() {
      const d = getAll();
      if (!d.current) {
        d.current = 'Semana Actual';
        d.lists['Semana Actual'] = JSON.parse(JSON.stringify(d.defaultItems));
        saveAll(d);
      }
      bindControls();
      populateWeekSelect();
      renderList();
    }
    function bindControls() {
      document.getElementById('createWeekBtn').onclick = createWeek;
      document.getElementById('deleteWeekBtn').onclick = deleteWeek;
      document.getElementById('weekSelect').onchange = switchWeek;
      document.getElementById('toggleHidden').onchange = renderList;
      document.getElementById('exportCsvBtn').onclick = exportCsv;
      document.getElementById('itemForm').onsubmit = onFormSubmit;
      document.getElementById('cancelAdd').onclick = cancelAdd;
    }
    function populateWeekSelect() {
      const sel = document.getElementById('weekSelect');
      sel.innerHTML = '';
      const d = getAll();
      for (let name in d.lists) {
        const o = new Option(name,name);
        if (name===d.current) o.selected=true;
        sel.append(o);
      }
    }
    function createWeek() {
      const name=document.getElementById('newWeekName').value.trim();
      if(!name) return alert('Nombre?');
      const d=getAll();
      if(d.lists[name]) return alert('Ya existe');
      d.lists[name]=JSON.parse(JSON.stringify(d.defaultItems));
      d.current=name; saveAll(d);
      populateWeekSelect(); renderList();
    }
    function deleteWeek(){
      const d=getAll();
      if(Object.keys(d.lists).length===1) return alert('No puedes eliminar');
      if(!confirm(`Eliminar ${d.current}?`)) return;
      delete d.lists[d.current];
      d.current=Object.keys(d.lists)[0]; saveAll(d);
      populateWeekSelect(); renderList();
    }
    function switchWeek(){
      const d=getAll();
      d.current=document.getElementById('weekSelect').value;
      saveAll(d);
      resetAddForm(); renderList();
    }
    function getItems(){ return getAll().lists[getAll().current]||[]; }
    function saveItems(it){ const d=getAll(); d.lists[d.current]=it; saveAll(d); }
    function onFormSubmit(e){
      e.preventDefault();
      const d=getAll(), items=d.lists[d.current];
      const it={
        name:document.getElementById('name').value.trim(),
        quantity:+document.getElementById('quantity').value,
        category:document.getElementById('category').value,
        aisle:document.getElementById('aisle').value.trim(),
        price:parseFloat(document.getElementById('price').value).toFixed(2),
        frequency:document.getElementById('frequency').value.trim(),
        notes:document.getElementById('notes').value.trim(),
        checked:false, hidden:false
      };
      items.push(it);
      if(document.getElementById('makeDefault').checked) d.defaultItems.push(it);
      saveAll(d);
      document.getElementById('itemForm').reset();
      renderList();
    }
    function resetAddForm(){
      editingIndex=null;
      document.getElementById('itemForm').reset();
      document.getElementById('submitBtn').textContent='Agregar ítem';
      document.getElementById('cancelAdd').style.display='none';
      document.getElementById('addItemSection').open=false;
      document.getElementById('itemForm').onsubmit=onFormSubmit;
    }
    function startEdit(i){
      const items=getItems(), it=items[i];
      editingIndex=i;
      document.getElementById('name').value=it.name;
      document.getElementById('quantity').value=it.quantity;
      document.getElementById('category').value=it.category;
      document.getElementById('aisle').value=it.aisle;
      document.getElementById('price').value=it.price;
      document.getElementById('frequency').value=it.frequency;
      document.getElementById('notes').value=it.notes;
      document.getElementById('makeDefault').checked=false;
      document.getElementById('submitBtn').textContent='Guardar cambios';
      document.getElementById('cancelAdd').style.display='inline-block';
      document.getElementById('addItemSection').open=true;
      document.getElementById('itemForm').onsubmit=function(e){
        e.preventDefault();
        const items=getItems();
        items[i]={
          name:document.getElementById('name').value.trim(),
          quantity:+document.getElementById('quantity').value,
          category:document.getElementById('category').value,
          aisle:document.getElementById('aisle').value.trim(),
          price:parseFloat(document.getElementById('price').value).toFixed(2),
          frequency:document.getElementById('frequency').value.trim(),
          notes:document.getElementById('notes').value.trim(),
          checked:it.checked, hidden:it.hidden
        };
        saveItems(items);
        resetAddForm(); renderList();
      };
    }
    function deleteItem(i){ const it=getItems(); it.splice(i,1); saveItems(it); renderList(); }
    function toggleChecked(i){ const it=getItems(); it[i].checked=!it[i].checked; saveItems(it); renderList(); }
    function toggleHidden(i){ const it=getItems(); it[i].hidden=!it[i].hidden; saveItems(it); renderList(); }
    function cancelAdd(){ resetAddForm(); renderList(); }

    function renderList(){
      const items=getItems(), showHidden=document.getElementById('toggleHidden').checked;
      const container=document.getElementById('itemList');
      container.innerHTML='';
      items.forEach;
      // build by category
      categoryOrder.forEach(cat=>{
        const group=items.map((it,i)=>({it,i}))
          .filter(({it})=>it.category===cat&&(!it.hidden||showHidden));
        if(!group.length) return;
        const details=document.createElement('details'); details.className='category-group'; details.open=true;
        const sum=document.createElement('summary'); sum.className='category-header'; sum.textContent=cat; details.append(sum);
        const ul=document.createElement('ul');
        group.forEach(({it:item,i:idx})=>{
          const li=document.createElement('li');
          if(item.checked) li.classList.add('checked');
          if(item.hidden&&showHidden) li.classList.add('showing-hidden');
          // header
          const hdr=document.createElement('div'); hdr.className='item-header';
          const chk=document.createElement('input'); chk.type='checkbox'; chk.className='item-checkbox'; chk.checked=item.checked;
          chk.addEventListener('click',e=>{e.stopPropagation();toggleChecked(idx);});
          const title=document.createElement('h2'); title.textContent=`${item.name} (x${item.quantity})`;
          title.addEventListener('click',()=>toggleChecked(idx));
          const btns=document.createElement('div');
          btns.append(
            makeBtn('Editar','edit',()=>startEdit(idx)),
            makeBtn(item.hidden?'Mostrar':'Ocultar',item.hidden?'show':'hide',()=>toggleHidden(idx)),
            makeBtn('Eliminar','delete',()=>deleteItem(idx))
          );
          hdr.append(chk,title,btns);
          const det=document.createElement('div'); det.className='item-details';
          det.innerHTML=`
            <strong>Pasillo:</strong> ${item.aisle||'-'}<br>
            <strong>Precio:</strong> $${item.price}<br>
            <strong>Frecuencia:</strong> ${item.frequency||'-'}<br>
            <strong>Notas:</strong> ${item.notes||'-'}
          `;
          li.append(hdr,det);
          ul.append(li);
        });
        details.append(ul);
        container.append(details);
      });
      updateTotalSpent();
      renderFilterList();
    }

    function updateTotalSpent(){
      const items=getItems();
      let total=0;
      items.forEach(i=>{
        if(i.checked){
          total += i.quantity * parseFloat(i.price);
        }
      });
      document.getElementById('totalSpent').textContent =
        'Total gastado: $' + total.toFixed(2);
    }

    function renderFilterList(){
      const items=getItems();
      const withA=items.filter(i=>i.aisle);
      const withoutA=items.filter(i=>!i.aisle);
      const byA={},byC={};
      withA.forEach(i=>(byA[i.aisle]=byA[i.aisle]||[]).push(i));
      withoutA.forEach(i=>(byC[i.category]=byC[i.category]||[]).push(i));
      const ctn=document.getElementById('filterList');
      ctn.innerHTML='<h2>Filtro: Pasillo y Categoría</h2>';
      Object.keys(byA).sort((a,b)=>{
        const na=+a,nb=+b;return(!isNaN(na)&&!isNaN(nb))?na-nb:a.localeCompare(b);
      }).forEach(a=>{
        const h3=document.createElement('h3');h3.textContent=`Pasillo ${a}`;
        const ul=document.createElement('ul');
        byA[a].forEach(it=>{const li=document.createElement('li');li.textContent=`${it.name} (x${it.quantity})`;ul.append(li);});
        ctn.append(h3,ul);
      });
      categoryOrder.forEach(cat=>{
        if(!byC[cat])return;
        const h3=document.createElement('h3');h3.textContent=cat;
        const ul=document.createElement('ul');
        byC[cat].forEach(it=>{const li=document.createElement('li');li.textContent=`${it.name} (x${it.quantity})`;ul.append(li);});
        ctn.append(h3,ul);
      });
    }

    function makeBtn(text,cls,fn){
      const b=document.createElement('button');
      b.textContent=text; b.className=cls;
      b.addEventListener('click',e=>{e.stopPropagation();fn();});
      return b;
    }

    function exportCsv(){
      const items=getItems();
      const hdr=['Nombre','Cantidad','Categoría','Pasillo','Precio','Frecuencia','Notas','Marcado','Oculto'];
      let csv=hdr.join(',')+'\n';
      items.forEach(i=>{
        csv+=[
          i.name,i.quantity,i.category,i.aisle,
          i.price,i.frequency,i.notes,i.checked,i.hidden
        ].map(f=>`"${f}"`).join(',')+'\n';
      });
      const blob=new Blob([csv],{type:'text/csv'});
      const url=URL.createObjectURL(blob),a=document.createElement('a');
      a.href=url;a.download=`lista_${getAll().current}.csv`;a.click();URL.revokeObjectURL(url);
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
